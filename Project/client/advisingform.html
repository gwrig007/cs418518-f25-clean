<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advising Form</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="container">
  <h1>Course Advising Form</h1>

  <form id="advisingForm">

    <!-- Current Term -->
    <label for="currentTerm">Current Term:</label>
    <select id="currentTerm" name="currentTerm" required>
      <option value="">Select Current Term</option>
      <option value="Spring 2025">Spring 2025</option>
      <option value="Summer 2025">Summer 2025</option>
      <option value="Fall 2025">Fall 2025</option>
      <option value="Spring 2026">Spring 2026</option>
      <option value="Summer 2026">Summer 2026</option>
      <option value="Fall 2026">Fall 2026</option>
      <option value="Spring 2027">Spring 2027</option>
      <option value="Summer 2027">Summer 2027</option>
      <option value="Fall 2027">Fall 2027</option>
    </select>

    <!-- Last Term Completed (NEW FIELD) -->
    <label for="lastTerm">Last Term Completed:</label>
    <select id="lastTerm" name="lastTerm" required>
      <option value="">Select Last Term Completed</option>
      <option value="Fall 2024">Fall 2024</option>
      <option value="Summer 2024">Summer 2024</option>
      <option value="Spring 2024">Spring 2024</option>
      <option value="Fall 2023">Fall 2023</option>
      <option value="Summer 2023">Summer 2023</option>
      <option value="Spring 2023">Spring 2023</option>
    </select>

    <!-- GPA -->
    <label for="lastGPA">Last GPA:</label>
    <input type="text" id="lastGPA" name="lastGPA" placeholder="e.g., 3.40" required />

    <button type="submit">Save</button>
  </form>

  <p id="saveStatus"></p>
</div>

<script>
const API_BASE = "https://cs418518-f25-clean.onrender.com";

// Load form with existing student data
async function loadForm() {
  try {
    const email = localStorage.getItem("email");
    if (!email) return;

    const response = await fetch(`${API_BASE}/advising/get?email=${email}`);
    const data = await response.json();

    if (data.success && data.advising) {
      const advising = data.advising;

      // Prefill fields
      document.getElementById("currentTerm").value = advising.current_term || "";
      document.getElementById("lastTerm").value = advising.last_term || "";
      document.getElementById("lastGPA").value = advising.last_gpa || "";
    }
  } catch (err) {
    console.error("Error loading form:", err);
  }
}

document.getElementById("advisingForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = localStorage.getItem("email");
  if (!email) {
    alert("User email not found.");
    return;
  }

  const body = {
    email: email,
    current_term: document.getElementById("currentTerm").value,
    last_term: document.getElementById("lastTerm").value,
    last_gpa: document.getElementById("lastGPA").value
  };

  try {
    const response = await fetch(`${API_BASE}/advising/save`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const result = await response.json();

    if (result.success) {
      document.getElementById("saveStatus").textContent = "Saved successfully!";
    } else {
      document.getElementById("saveStatus").textContent = "Save failed.";
    }
  } catch (err) {
    document.getElementById("saveStatus").textContent = "An error occurred.";
    console.error("Save error:", err);
  }
});

// Run on page load
loadForm();
</script>

</body>
</html>
