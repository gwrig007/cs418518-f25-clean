<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | ODU Course Advising Portal</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
<header>
  <div style="display:flex;align-items:center;gap:15px;">
    <img src="https://upload.wikimedia.org/wikipedia/en/2/2d/Old_Dominion_Monarchs_logo.svg" />
    <h1>ODU Course Advising Portal</h1>
  </div>

  <div class="dropdown" id="menuDropdown">
    <button class="dropdown-toggle">☰ Menu</button>
    <div class="dropdown-menu">
      <a href="profile.html">Profile</a>
      <a href="classes.html">Course Advising</a>
      <a href="#" id="logoutLink">Logout</a>
    </div>
  </div>
</header>

<div class="content">
  <h2 class="welcome">Welcome, <span id="username">Student</span>!</h2>
  <p class="info">
    Access your course advising information, update your academic profile, and manage your enrolled classes easily.
  </p>
</div>

<footer>© 2025 Old Dominion University</footer>

<script>
const backendBaseUrl =
  location.hostname.includes("localhost")
    ? "http://127.0.0.1:8080"
    : "https://cs418518-f25-clean.onrender.com";

/* ✅ AUTH CHECK */
const email = localStorage.getItem("userEmail");
const usernameEl = document.getElementById("username");

if (!email) {
  alert("Session expired. Please sign in again.");
  window.location.href = "signin.html";
}

/* ✅ LOAD USER PROFILE */
fetch(`${backendBaseUrl}/user/profile?email=${encodeURIComponent(email)}`)
  .then(res => res.json())
  .then(data => {
    if (!data?.firstName) return;

    const fullName = `${data.firstName} ${data.lastName}`.trim();
    usernameEl.textContent = fullName;
    localStorage.setItem("username", fullName);
  })
  .catch(() => console.warn("Profile fetch failed"));

/* ✅ DROPDOWN */
document.querySelector(".dropdown-toggle").onclick = () =>
  document.getElementById("menuDropdown").classList.toggle("show");

window.onclick = e => {
  const menu = document.getElementById("menuDropdown");
  if (!menu.contains(e.target)) menu.classList.remove("show");
};

/* ✅ LOGOUT */
document.getElementById("logoutLink").onclick = () => {
  localStorage.clear();
  window.location.href = "signin.html";
};
</script>

</body>
</html>
