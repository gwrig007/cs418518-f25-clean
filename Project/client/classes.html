<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Courses</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 25px;
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }

    .course-box, .form-box {
      background: #f9f9f9;
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .btn {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 20px;
      background: #0050b3;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      transition: 0.2s;
    }

    .btn:hover {
      background: #003d8a;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      border-radius: 6px;
      margin: 10px 0;
    }

    .form-status {
      font-weight: bold;
    }

    .view-btn {
      padding: 8px 12px;
      background: #0066cc;
      color: white;
      border-radius: 6px;
      text-decoration: none;
    }

    .view-btn:hover {
      background: #004c99;
    }
  </style>
</head>

<body>

  <div class="container">
    <h1>Your Courses & Advising Forms</h1>

    <!-- CURRENT COURSES -->
    <h2>Current Courses</h2>
    <div id="currentCourses">
      <p>Loading...</p>
    </div>

    <!-- COMPLETED COURSES -->
    <h2>Completed Courses</h2>
    <div id="completedCourses">
      <p>Loading...</p>
    </div>

    <!-- ADVISING FORMS -->
    <h2>Your Advising Forms</h2>
    <div id="formsList">
      <p>Loading...</p>
    </div>

    <a class="btn" href="advisingform.html">Create New Advising Form</a>
  </div>

  <script>
    const email = localStorage.getItem("userEmail");

    /* ---------------- Load Current Courses ---------------- */
    async function loadCurrent() {
      const res = await fetch(`/advising/current-courses?email=${email}`);
      const data = await res.json();

      const box = document.getElementById("currentCourses");
      box.innerHTML = data.length
        ? data.map(c => `<div class="course-box">${c}</div>`).join("")
        : "<p>No current courses.</p>";
    }

    /* ---------------- Load Completed Courses ---------------- */
    async function loadCompleted() {
      const res = await fetch(`/advising/taken-courses?email=${email}`);
      const data = await res.json();

      const box = document.getElementById("completedCourses");
      box.innerHTML = data.length
        ? data.map(c => `<div class="course-box">${c}</div>`).join("")
        : "<p>No completed courses.</p>";
    }

    /* ---------------- Load Advising Forms ---------------- */
    async function loadForms() {
      const res = await fetch(`/advising/forms?email=${email}`);
      const data = await res.json();

      const box = document.getElementById("formsList");

      if (!data.length) {
        box.innerHTML = "<p>No advising forms submitted yet.</p>";
        return;
      }

      box.innerHTML = data
        .map(
          f => `
          <div class="form-row">
            <div>
              <div><strong>Term:</strong> ${f.current_term}</div>
              <div class="form-status"><strong>Status:</strong> ${f.status}</div>
              <div><small>Submitted: ${new Date(f.created_at).toLocaleString()}</small></div>
            </div>

            <a class="view-btn" href="advisingform.html?id=${f.id}">
              View / Edit
            </a>
          </div>
        `
        )
        .join("");
    }

    loadCurrent();
    loadCompleted();
    loadForms();
  </script>

</body>
</html>
