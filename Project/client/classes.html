<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advising Dashboard | ODU</title>
<link rel="stylesheet" href="style.css">
<style>
.container { max-width: 900px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
h1 { text-align: center; }
.course-box, .form-row { background: #f9f9f9; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd; }
.btn { padding: 10px 15px; background: #0050b3; color: #fff; border-radius: 6px; text-decoration: none; cursor: pointer; }
.btn:hover { background: #003d8a; }
.view-btn { padding: 6px 10px; background: #0066cc; color: #fff; border-radius: 6px; text-decoration: none; }
.view-btn:hover { background: #004c99; }
</style>
</head>
<body>

<div class="container">
  <h1>Advising Dashboard</h1>
  <button class="btn" onclick="window.location.href='advisingform.html'">âž• New Advising Form</button>

  <h2>Current Courses</h2>
  <div id="currentCourses"><p>Loading...</p></div>

  <h2>Courses Taken Last Term</h2>
  <div id="takenCourses"><p>Loading...</p></div>

  <h2>Your Advising Forms</h2>
  <div id="formsList"><p>Loading...</p></div>
</div>

<script>
const BASE_URL = "https://cs418518-f25-clean.onrender.com/advising";
const email = localStorage.getItem("userEmail");
if (!email) { alert("Sign in required."); window.location.href="signin.html"; }

async function fetchData(endpoint) {
  try {
    const res = await fetch(`${BASE_URL}/${endpoint}?email=${encodeURIComponent(email)}`);
    if (!res.ok) throw new Error("Failed to fetch " + endpoint);
    return await res.json();
  } catch (err) {
    console.error(err);
    return [];
  }
}

async function loadCurrentCourses() {
  const courses = await fetchData("current-courses");
  const container = document.getElementById("currentCourses");
  container.innerHTML = courses.length ? courses.map(c => `<div class="course-box">${c}</div>`).join("") : "<p>No current courses.</p>";
}

async function loadTakenCourses() {
  const courses = await fetchData("taken-courses");
  const container = document.getElementById("takenCourses");
  container.innerHTML = courses.length ? courses.map(c => `<div class="course-box">${c}</div>`).join("") : "<p>No taken courses.</p>";
}

async function loadForms() {
  const forms = await fetchData("forms");
  const container = document.getElementById("formsList");
  if (!forms.length) { container.innerHTML="<p>No advising forms submitted yet.</p>"; return; }
  container.innerHTML = forms.map(f => `
    <div class="form-row">
      <div><strong>Term:</strong> ${f.current_term}<br><strong>Status:</strong> ${f.status}<br><small>Submitted: ${new Date(f.created_at).toLocaleString()}</small></div>
      <a class="view-btn" href="advisingform.html?formId=${f.id}">View / Edit</a>
    </div>`).join("");
}

loadCurrentCourses();
loadTakenCourses();
loadForms();
</script>

</body>
</html>
