<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8" />
  <title>Review Advising Form</title>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f4f6fa;
      padding: 40px;
    }

    .box {
      background: white;
      max-width: 700px;
      margin: auto;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
      color: #003366;
    }

    ul {
      padding-left: 20px;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 10px;
      resize: vertical;
    }

    button {
      margin-top: 12px;
      background: #003366;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 8px;
    }

    button:hover {
      background: #00509e;
    }
  </style>
</head>

<body>
<div class="box">
  <h2 id="studentName">Student</h2>
  <p><strong>Term:</strong> <span id="term"></span></p>
  <p><strong>Status:</strong> <span id="status"></span></p>

  <h3>Courses</h3>
  <ul id="courseList"></ul>

  <h3>Admin Feedback</h3>
  <textarea id="message" placeholder="Enter feedback for the student..."></textarea>

  <br>
  <button onclick="submitDecision('Approved')">✅ Approve</button>
  <button onclick="submitDecision('Rejected')">❌ Reject</button>
  <button onclick="goBack()">⬅ Back</button>
</div>

<script>
const BASE = "https://cs418518-f25-clean.onrender.com";
const id = new URLSearchParams(window.location.search).get("id");

async function loadForm() {
  try {
    const res = await fetch(`${BASE}/advising/admin/forms/${id}`);
    const data = await res.json();

    document.getElementById("studentName").textContent = data.name;
    document.getElementById("term").textContent = data.current_term;
    document.getElementById("status").textContent = data.status;

    const ul = document.getElementById("courseList");
    ul.innerHTML = "";

    data.courses.forEach(c => {
      const li = document.createElement("li");
      li.textContent = c.course_name;
      ul.appendChild(li);
    });

  } catch (err) {
    alert("Failed to load advising record");
    console.error(err);
  }
}

async function submitDecision(status) {
  const message = document.getElementById("message").value;
  if (!message) return alert("Please enter feedback.");

  await fetch(`${BASE}/advising/admin/decision`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, status, message })
  });

  alert("Decision saved.");
  window.location.href = "admin.html";
}

function goBack() {
  window.location.href = "admin.html";
}

// Load the selected form
loadForm();
</script>
</body>
</html>
